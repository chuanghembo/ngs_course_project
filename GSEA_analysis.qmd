## Load packages

```{r}
library(tidyverse)
library(fgsea)
library(msigdbr)
```

## Rank data

```{r}
data_path <- '../PP1DTLeukemia_vs_WTLeukemia_none_filtered.csv'
data <- read_csv(data_path)

ranked_genes <- data |>
        na.omit() |> 
        mutate(gene = str_remove(row, "\\..*")) |>
        mutate(rank = -log10(padj)) |> 
        arrange(-rank) |> 
        dplyr::select(gene, rank)

```

## Fetch geneset

```{r}
# Look at species
msigdbr_species() 

gene_set <- msigdbr(species = "Mus musculus",
                    category = 'C5',
                    subcategory = 'BP')

BP_list = split(x = gene_set$ensembl_gene, f = gene_set$gs_name)



```

```{r}
gene_stat  <- ranked_genes |> 
        dplyr::select(rank) |> 
        unlist() 

names(gene_stat) <- ranked_genes$gene
```

```{r}
fgseaRes <- fgsea(pathways = BP_list, stats = gene_stat)
```

```{r}
dexsq <- read_tsv('../results_dexsq.tsv')
```

```{r}
dexsq <- dexsq |> 
        dplyr::select(groupID,padj) |> 
        na.omit() |> 
        mutate(gene = str_remove(groupID, "\\.\\d+$")) |>
        mutate(rank = -log10(padj)) |> 
        arrange(-rank) |> 
        dplyr::select(gene,rank)
```

```{r}
dexsq_stat  <- dexsq |> 
        dplyr::select(rank) |> 
        unlist()
        
names(dexsq_stat) <- dexsq$gene
```

```{r}
dexsq_Res <- fgsea(pathways = BP_list, stats = dexsq_stat)
```
